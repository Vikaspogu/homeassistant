automation:

    ####################################################
    #                                                  #
    #                   AUTOMATIONS                    #
    #                                                  #
    ####################################################

  - alias: Update Tesla location as MQTT location updates
    initial_state: on
    trigger:
      - platform: mqtt
        topic: teslamate/cars/1/latitude
      - platform: mqtt
        topic: teslamate/cars/1/longitude
    action:
      - service: device_tracker.see
        data_template:
          dev_id: tesla_location
          gps:
            [
              "{{ states.sensor.tesla_latitude.state }}",
              "{{ states.sensor.tesla_longitude.state }}",
            ]
    id: 77069c1dd26b4913b7fbbb00ae85b688

  - alias: Open garage if car returns home
    initial_state: on
    trigger:
    - platform: state
      entity_id: device_tracker.tesla_location
      from: not_home
      to: home
    action:
    - service: cover.open_cover
      entity_id: cover.garage_door
    id: 78aa903d4f1d4085b77726ac84b0faeb

  - alias: Close garage if car is away
    initial_state: on
    trigger:
    - platform: state
      entity_id: device_tracker.tesla_location
      from: home
      to: not_home
    action:
    - service: cover.close_cover
      entity_id: cover.garage_door
    id: 3d9513db194f4f44b8310e57949968d1

  - alias: Set timer if teslamate reports something is open to alert us
    initial_state: on
    trigger:
      - platform: mqtt
        topic: teslamate/cars/1/windows_open
        payload: "true"
      - platform: mqtt
        topic: teslamate/cars/1/doors_open
        payload: "true"
      - platform: mqtt
        topic: teslamate/cars/1/trunk_open
        payload: "true"
      - platform: mqtt
        topic: teslamate/cars/1/frunk_open
        payload: "true"
    action:
      - service: script.turn_on
        data_template:
          entity_id: script.notify_tesla_{{trigger.topic.split('/')[3]}}

  - alias: Cancel notification if said door/window is closed
    initial_state: on
    trigger:
      - platform: mqtt
        topic: teslamate/cars/1/windows_open
        payload: "false"
      - platform: mqtt
        topic: teslamate/cars/1/doors_open
        payload: "false"
      - platform: mqtt
        topic: teslamate/cars/1/trunk_open
        payload: "false"
      - platform: mqtt
        topic: teslamate/cars/1/frunk_open
        payload: "false"
    action:
      - service: script.turn_off
        data_template:
          entity_id: script.notify_tesla_{{trigger.topic.split('/')[3]}}

  - id: vacuum_notifications
    alias: Vacuum Notifications
    trigger:
    - platform: state
      entity_id: vacuum.robovac
    - platform: state
      entity_id: vacuum.roomba
    condition:
      condition: template
      value_template: '{{ not (trigger.to_state.state == trigger.from_state.state) }}'
    action:
    - service: notify.mobile_app_vpogu_pixel_6
      data_template:
        title: Vacuum
        message: 'ðŸ§¹ {{ trigger.to_state.name }} vacuum has been turned {{ trigger.to_state.state
          }}'
