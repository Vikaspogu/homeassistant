automation:

    ####################################################
    #                                                  #
    #                   AUTOMATIONS                    #
    #                                                  #
    ####################################################

  - id: set_welcome_scene_on_restart
    alias: Set input entity for welcome on restart
    description: Enable welcome scene collapse on Home Assistant startup
    trigger:
      - trigger: homeassistant
        event: start
    action:
      - action: input_boolean.turn_on
        target:
          entity_id: input_boolean.welcome_scene_collapse

  - id: garage_door_open_reminder
    alias: Garage Door Open Reminder
    description: Send notification every 30 minutes while garage door is open
    mode: single
    trigger:
      - trigger: time_pattern
        minutes: "/30"
    condition:
      - condition: state
        entity_id: cover.garage_door_opener
        state: open
    action:
      - action: notify.notify_group
        data:
          message: "The garage door has been open"
          data:
            actions:
              - action: close_garage
                title: Close Garage Door

  - id: close_garage_door_action
    alias: Actionable notification - close garage door
    description: Handle actionable notification to close main garage door
    mode: single
    trigger:
      - trigger: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_garage
    action:
      - action: cover.close_cover
        target:
          entity_id: cover.garage_door_opener

  - id: vw_garage_door_open_reminder
    alias: VW Garage Door Open Reminder
    description: Send notification every 30 minutes while VW garage door is open
    mode: single
    trigger:
      - trigger: time_pattern
        minutes: "/30"
    condition:
      - condition: state
        entity_id: cover.ratgdo32_7b2420_door
        state: open
    action:
      - action: notify.notify_group
        data:
          message: "The VW garage door has been open"
          data:
            actions:
              - action: close_garage_vw
                title: Close Garage Door

  - id: close_vw_garage_door_action
    alias: Actionable notification - close garage door VW
    description: Handle actionable notification to close VW garage door
    mode: single
    trigger:
      - trigger: event
        event_type: mobile_app_notification_action
        event_data:
          action: close_garage_vw
    action:
      - action: cover.close_cover
        target:
          entity_id: cover.ratgdo32_7b2420_door
    
  # - alias: Open garage if car returns home
  #   initial_state: on
  #   trigger:
  #     - platform: state
  #       entity_id: device_tracker.2025_cadillac_optiq
  #       from: not_home
  #       to: home
  #   condition:
  #     - condition: numeric_state
  #       entity_id: sensor.uptime_minutes
  #       above: 2
  #     - condition: state
  #       entity_id: cover.garage_door_opener
  #       state: "closed"
  #   action:
  #     - service: cover.open_cover
  #       entity_id: cover.garage_door_opener
  #   id: 78aa903d4f1d4085b77726ac84b0faeb

  # - alias: Close garage if car is away
  #   initial_state: on
  #   trigger:
  #     - platform: state
  #       entity_id: device_tracker.2025_cadillac_optiq
  #       from: home
  #       to: not_home
  #   condition:
  #     - condition: state
  #       entity_id: cover.garage_door_opener
  #       state: "open"
  #   action:
  #     - service: cover.close_cover
  #       entity_id: cover.garage_door_opener
  #   id: 3d9513db194f4f44b8310e57949968d1

  # - alias: Open garage if VW returns home
  #   initial_state: on
  #   trigger:
  #     - platform: state
  #       entity_id: device_tracker.vpogu_pixel_9
  #       from: not_home
  #       to: home
  #   condition:
  #     - condition: or
  #       conditions:
  #         - condition: state
  #           entity_id: binary_sensor.vpogu_pixel9_android_auto
  #           state: "on"
  #         - condition: state
  #           entity_id: binary_sensor.spogu_pixel_9_android_auto
  #           state: "on"
  #     - condition: state
  #       entity_id: cover.garage_door_opener
  #       state: "closed"
  #   action:
  #     - service: cover.open_cover
  #       entity_id: cover.garage_door_opener
  #   id: 3d9513db194f4f44b8310e57949968e6

  # - alias: Close garage if VW is away
  #   initial_state: on
  #   trigger:
  #     - platform: state
  #       entity_id: device_tracker.vpogu_pixel_9
  #       from: home
  #       to: not_home
  #   condition:
  #     - condition: state
  #       entity_id: cover.garage_door_opener
  #       state: "open"
  #     - condition: or
  #       conditions:
  #         - condition: state
  #           entity_id: binary_sensor.vpogu_pixel9_android_auto
  #           state: "on"
  #         - condition: state
  #           entity_id: binary_sensor.spogu_pixel_9_android_auto
  #           state: "on"
  #   action:
  #     - service: cover.close_cover
  #       entity_id: cover.garage_door_opener
  #   id: 3d9513db194f4f44b8310e57949968s2

  - id: smart_thermostat_control
    alias: Smart Thermostat Control
    description: >
      Automatically control thermostat based on time, bedroom temperature, and season.
    mode: single
    trigger:
      - trigger: time_pattern
        minutes: "/25"
    condition:
      - condition: state
        entity_id: input_boolean.override_temperature_control
        state: "off"
    action:
      - variables:
          bedroom_temp: "{{ states('sensor.bedroom_temperature_temperature') | float(0) }}"
          outdoor_temp: "{{ states('sensor.outside_temperature') | float(0) }}"
          hvac_mode: "{{ states('climate.thermostat') }}"
          current_temp: "{{ state_attr('climate.thermostat', 'current_temperature') | float(0) }}"
          hour: "{{ now().hour }}"
          is_summer: "{{ states('sensor.season') == 'summer' }}"
      - choose:
          # Turn off thermostat from 9 AM to 3 PM
          - conditions:
              - condition: numeric_state
                entity_id: sensor.bedroom_temperature_temperature
                above: 0
              - condition: template
                value_template: "{{ 9 <= hour < 15 }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - action: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - action: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}F | Outside: {{ outdoor_temp }}F - Set thermostat to off

          # SUMMER: If bedroom temp > 74, set to 73F cool
          - conditions:
              - condition: template
                value_template: "{{ is_summer and bedroom_temp > 74 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode == 'off' }}"
            sequence:
              - action: climate.set_temperature
                target:
                  entity_id: climate.thermostat
                data:
                  temperature: 73
                  hvac_mode: cool
              - action: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}F | Outside: {{ outdoor_temp }}F - Set thermostat to 73F (cool mode)

          # SUMMER: If bedroom temp < 73, turn off
          - conditions:
              - condition: template
                value_template: "{{ is_summer and bedroom_temp < 73 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - action: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - action: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}F | Outside: {{ outdoor_temp }}F - Set thermostat to off

          # WINTER: If bedroom temp < 69, set to 70F heat
          - conditions:
              - condition: template
                value_template: "{{ not is_summer and bedroom_temp < 69 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode == 'off' }}"
            sequence:
              - action: climate.set_temperature
                target:
                  entity_id: climate.thermostat
                data:
                  temperature: 70
                  hvac_mode: heat
              - action: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}F | Outside: {{ outdoor_temp }}F - Set thermostat to 70F (heat mode)

          # WINTER: If bedroom temp > 71, turn off
          - conditions:
              - condition: template
                value_template: "{{ not is_summer and bedroom_temp > 71 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - action: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - action: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}F | Outside: {{ outdoor_temp }}F - Set thermostat to off
