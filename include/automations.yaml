automation:

    ####################################################
    #                                                  #
    #                   AUTOMATIONS                    #
    #                                                  #
    ####################################################
  - alias: Set input entity for welcome on restart
    trigger:
      platform: homeassistant
      event: start
    action:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.welcome_scene_collapse

  - id: 769638308a0a4973b8930f7a6f2a2693
    alias: Garage Door Opened
    trigger:
      - platform: state
        entity_id: cover.garage_door_opener
        to: open
    condition:
      condition: state
      entity_id: cover.garage_door_opener
      state: open
    action:
      - service: timer.start
        entity_id: timer.garage_door_2

  - id: garage_closed
    alias: Garage Door Closed
    trigger:
    - platform: state
      entity_id: cover.garage_door_opener
      to: closed
    action:
      - service: timer.cancel
        entity_id: timer.garage_door_2

  - id: garage_opened_timer_finished
    alias: Garage Opened Timer Finished
    trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.garage_door_2
    condition:
      condition: state
      entity_id: cover.garage_door_opener
      state: open
    action:
      - service: timer.start
        entity_id: timer.garage_door_2
      - service: notify.notify_group
        data:
          message: "⚠️ The garage door has been open"
          data:
            actions:
              - action: close_garage
                title: Close Garage Door

  - alias: Actionable notification - close garage door
    trigger:
      platform: event
      event_type: mobile_app_notification_action
      event_data:
        action: close_garage
    action:
      service: cover.close_cover
      entity_id: cover.garage_door_opener
      data: {}
    id: c696dd277c6546ecb1f4e0f82052822f

  - alias: Open garage if car returns home
    initial_state: on
    trigger:
      - platform: state
        entity_id: device_tracker.2025_cadillac_optiq_super_cruise
        from: not_home
        to: home
    condition:
      - condition: numeric_state
        entity_id: sensor.uptime_minutes
        above: 2
      - condition: state
        entity_id: cover.garage_door_opener
        state: "closed"
    action:
      - service: cover.open_cover
        entity_id: cover.garage_door_opener
    id: 78aa903d4f1d4085b77726ac84b0faeb

  - alias: Close garage if car is away
    initial_state: on
    trigger:
      - platform: state
        entity_id: device_tracker.2025_cadillac_optiq_super_cruise
        from: home
        to: not_home
    condition:
      - condition: state
        entity_id: cover.garage_door_opener
        state: "open"
    action:
      - service: cover.close_cover
        entity_id: cover.garage_door_opener
    id: 3d9513db194f4f44b8310e57949968d1

  - alias: Open garage if VW returns home
    initial_state: on
    trigger:
      - platform: state
        entity_id: device_tracker.vpogu_pixel_9
        from: not_home
        to: home
    condition:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.vpogu_pixel9_android_auto
            state: "on"
          - condition: state
            entity_id: binary_sensor.spogu_pixel_9_android_auto
            state: "on"
      - condition: state
        entity_id: cover.garage_door_opener
        state: "closed"
    action:
      - service: cover.open_cover
        entity_id: cover.garage_door_opener
    id: 3d9513db194f4f44b8310e57949968e6

  - alias: Close garage if VW is away
    initial_state: on
    trigger:
      - platform: state
        entity_id: device_tracker.vpogu_pixel_9
        from: home
        to: not_home
    condition:
      - condition: state
        entity_id: cover.garage_door_opener
        state: "open"
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.vpogu_pixel9_android_auto
            state: "on"
          - condition: state
            entity_id: binary_sensor.spogu_pixel_9_android_auto
            state: "on"
    action:
      - service: cover.close_cover
        entity_id: cover.garage_door_opener
    id: 3d9513db194f4f44b8310e57949968s2

  - id: smart_thermostat_control
    alias: Smart Thermostat Control
    description: >
      Automatically control thermostat based on time, bedroom temperature, and season.
    trigger:
      - platform: time_pattern
        minutes: "/25"  # Check every 5 minutes
    condition:
      - condition: state
        entity_id: input_boolean.override_temperature_control
        state: "off"
    action:
      - variables:
          bedroom_temp: "{{ states('sensor.bedroom_temperature_temperature') | float }}"
          outdoor_temp: "{{ states('sensor.outside_temperature') | float }}"
          hvac_mode: "{{ states('climate.thermostat') }}"
          current_temp: "{{ state_attr('climate.thermostat', 'current_temperature') | float }}"
          hour: "{{ now().hour }}"
          is_summer: "{{ states('sensor.season') == 'summer'}}"
      - choose:
          # Turn off thermostat from 8 AM to 4 PM
          - conditions:
              - condition: numeric_state
                entity_id: sensor.bedroom_temperature_temperature
                above: 0  # Just to ensure it's available
              - condition: template
                value_template: "{{ 9 <= hour < 15 }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - service: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - service: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}°F | Outside: {{ outdoor_temp }}°F
                    → Set thermostat to off

          # SUMMER: If bedroom temp > 74, set to 73°F cool
          - conditions:
              - condition: template
                value_template: "{{ is_summer and bedroom_temp > 74 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode == 'off' }}"
            sequence:
              - service: climate.set_temperature
                target:
                  entity_id: climate.thermostat
                data:
                  temperature: 73
                  hvac_mode: cool
              - service: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}°F | Outside: {{ outdoor_temp }}°F
                    → Set thermostat to 73°F (cool mode)

          # SUMMER: If bedroom temp < 73, turn off
          - conditions:
              - condition: template
                value_template: "{{ is_summer and bedroom_temp < 73 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - service: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - service: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}°F | Outside: {{ outdoor_temp }}°F
                    → Set thermostat to off

          # WINTER: If bedroom temp < 69, set to 70°F heat
          - conditions:
              - condition: template
                value_template: "{{ not is_summer and bedroom_temp < 69 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode == 'off' }}"
            sequence:
              - service: climate.set_temperature
                target:
                  entity_id: climate.thermostat
                data:
                  temperature: 70
                  hvac_mode: heat
              - service: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}°F | Outside: {{ outdoor_temp }}°F
                    → Set thermostat to 70°F (heat mode)

          # WINTER: If bedroom temp > 71, turn off
          - conditions:
              - condition: template
                value_template: "{{ not is_summer and bedroom_temp > 71 and not (9 <= hour < 15) }}"
              - condition: template
                value_template: "{{ hvac_mode != 'off' }}"
            sequence:
              - service: climate.turn_off
                target:
                  entity_id: climate.thermostat
              - service: notify.mobile_app_vpogu_pixel9
                data:
                  message: >
                    Bedroom: {{ bedroom_temp }}°F | Outside: {{ outdoor_temp }}°F
                    → Set thermostat to off
    mode: single
